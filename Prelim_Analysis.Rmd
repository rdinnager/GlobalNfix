---
title: "Preliminary Latitude Analysis"
author: "Russell Dinnage and Anna Simonsen"
date: "Saturday, August 02, 2014"
output: 
  html_document:
    highlight: pygments
---

```{r knitr_init, echo=FALSE, results="asis", cache=FALSE}
library(knitr)

## Global options
options(max.print="75")
opts_chunk$set(fig.path="out/",
               echo=TRUE,
         cache=TRUE,
               cache.path="cache/",
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

Here we will document a preliminary analysis of GBIF data and nitrogen fixation data on legumes. The first step is to load our data and then generate latitude data by species. In this initial analysis we will simply use the median latitude of all GBIF records for each species.

```{r load_agg}
library(GlobalNfix)
library(dplyr)
data(full_legume_data)
full_legume_data <- full_legume_data %>% tbl_df
full_legume_data
legume_dat <- full_legume_data %>% 
  mutate(fixing = ifelse(Data_fixing == "Yes", 1, 0)) %>%
  group_by(Species) %>% 
  summarise(median_lat = median(decimalLatitude), 
            median_long = median(decimalLongitude), 
            fixer = mean(fixing))
legume_dat
```

As a first basic analysis, we will run a logistic regression with nitrogen fixation as the response variable, and median latitude as the predictor variable.

```{r log_reg, dev='svg'}
library(ggplot2)
leg_mod <- glm(fixer~abs(median_lat)*median_long, data = legume_dat, family = binomial())
summary(leg_mod)
p <- ggplot(legume_dat, aes(median_lat, fixer)) + geom_point(alpha=0.25, position = position_jitter(width = 0, height = 0.1)) + stat_smooth(color = "black", size = 1.0) + theme_bw()
p
```

At least in this preliminary analysis, it appears that there is indeed a fairly strong pattern of nitrogen fixation with latitude. There are several issues we need to try and account for to make sure this is robust, of course. One is dealing with error in the database (this analysis uses the whole database not just the part that has been corrected). Another is the issue of introduced species. GBIF makes not distinction between native or introduced. We are hoping we can deal with this by looking at the native vs. introduced status of legume species as recorded in the ILDIS database.

